<?xml version="1.0"?>
<testCase version="8.4.0.202012071239">
    <general>
        <documentation>Firewall - Block Based on TCP Source Port</documentation>
        <notes>
</notes>
        <language>Python</language>
    </general>
    <execution renderCommentsIntoIssues="true">
        <parameters version="8.4.0.202012071239">
            <parameters escape="true">
                <parameters xmlns:pt="http://www.fnfr.com/schemas/parameterTree">
                    <destination_ip pt:description="IP address which a firewall outbound rule will be configured with to test destination IP blockage.">4.2.2.2</destination_ip>
                    <destination_ip2 pt:description="IP address which will be used to test destination IP blockage.">8.8.8.8</destination_ip2>
                </parameters>
            </parameters>
        </parameters>
    </execution>
    <testbed>project://a_voip/topologies/VeloCloud/VC840/VC840_lab_basic_adtran.tbml</testbed>
    <procedures>
        <item name="main">
            <steps>
                <item guid="e1b55e77-e38d-418d-9ab4-06b3539e6b1b" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>Opening devices...</body>
                    </command>
                    <nestedSteps>
                        <item guid="347eb16c-4b9a-4144-8bb9-0d550a8525a4" action="open" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>device:SD-WAN#python</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.OpenStepPropertyGroup">
                                <stepProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                <sessionProperties type="com.fnfr.svt.applications.python.PythonSessionProperties"/>
                                <sessionClass type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                <sessionVersion type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                            </applicationProperties>
                        </item>
                        <item guid="029ebbe5-ad8a-46b3-86db-dc0b584c0323" action="open" session="CPE">
                            <command>
                                <body>device:CPE#ssh</body>
                            </command>
                            <eventHandlers>
                                <item name="OnFailTestAction"/>
                            </eventHandlers>
                            <applicationProperties type="com.fnfr.svt.documents.OpenStepPropertyGroup">
                                <stepProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                                <sessionProperties type="com.fnfr.svt.applications.ssh.documents.SSHProperties"/>
                                <sessionClass type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                <sessionVersion type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                            </applicationProperties>
                        </item>
                        <item guid="0ec16c9c-f1b8-42a9-8d41-b6f610e4feab" action="Login" session="CPE" useFieldsInCommand="false">
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="b17843d2-d1fc-4297-aa74-e5eb79d75499" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>Importing modules...</body>
                    </command>
                    <nestedSteps>
                        <item guid="60a58e01-91e8-48ed-aa35-1545e533a872" action="command" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>from firewall.firewall_4_06_verify_block_tcp_source_port import *</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="5be92573-4897-4fe0-9508-d6eb12370489" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>Initializing variables...</body>
                    </command>
                    <nestedSteps>
                        <item guid="9d027978-f996-4da7-aed7-52013f550fb0" action="command" session="SD-WAN">
                            <command>
                                <body>edge_id = &quot;[tbml(&apos;property&apos;, &apos;-name&apos;, &apos;SD-WAN&apos;, &apos;edgeId&apos;)]&quot;</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                            <performResponseMapping>false</performResponseMapping>
                        </item>
                        <item guid="fc407384-93ae-4a2b-b81a-7a37090800db" action="command" session="SD-WAN">
                            <command>
                                <body>enterprise_id = &quot;[tbml(&apos;property&apos;, &apos;-name&apos;, &apos;SD-WAN&apos;, &apos;enterpriseId&apos;)]&quot;</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                            <performResponseMapping>false</performResponseMapping>
                        </item>
                        <item guid="6fc8c0ce-5048-4d6e-a205-709ba0d8a78e" action="command" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>create_edge(edge_id=edge_id, enterprise_id=enterprise_id, ssh_port=0)</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="41cb3b21-8037-40fc-9490-d0dc7125349f" action="comment" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="85d7a353-61c5-4686-bb20-582f920dbecf" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>CPE: Changing SIP Registration protocol to TCP...</body>
                    </command>
                    <nestedSteps>
                        <item guid="a824e942-bdd9-4100-b5ec-4265e37910bf" action="ChangeRegProtocolToTCP" session="CPE" useFieldsInCommand="false">
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                        <item guid="a3b2379e-6ce3-417a-a5b3-c353ec7113ee" action="GetRegStatusNeutral" session="CPE" useFieldsInCommand="false">
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>reg_status()</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;OK&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                            <message>CPE: Registration Status is OK after changing SIP Registration protocol to TCP.</message>
                                                        </actionProperties>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="RepeatStep">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="6" delayBetweenRepeats="20.0"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <eventHandlers>
                                <item name="OnRepeatStepMaxCountExceeded">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                            <message>Maximum number of attempts of {0} has reached the limit</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                            <message>Changing SIP Registration protocol to TCP did not came back as registering.</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="FailTest">
                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                    </item>
                                    <item actionId="ExitExecution">
                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                    </item>
                                </item>
                            </eventHandlers>
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="a0994c85-cbd9-4b76-b30f-2757635d8a59" action="comment" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="b22ebc04-068a-4f22-892f-9fbe4f79c0dc" action="comment">
                    <command>
                        <body>EDGE: Adding firewall rule to block outbound traffic based on TCP Source Port 5060...</body>
                    </command>
                    <nestedSteps>
                        <item guid="c1242009-991e-47c9-9578-690a68a5377b" action="command" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>add_firewall_rule_block_tcp_source_port()</body>
                            </command>
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>item_item_by_key(&quot;error&quot;)</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;None&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                                            <message>EDGE: Firewall rule added successfully. </message>
                                                        </actionProperties>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="FailTest">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                                            <message>EDGE: Error adding firewall rule. [value]. Exiting execution.</message>
                                                        </actionProperties>
                                                    </item>
                                                    <item actionId="ExitExecution">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="10b57741-2ed8-4841-80dd-734e4b4d1bf7" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>Waiting for 10 seconds for change to take effect...</body>
                    </command>
                    <nestedSteps>
                        <item guid="7dfdd9c2-a784-4106-a22a-29fb89ceda08" action="sleep">
                            <command>
                                <body>10</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="2e7217ce-e4a6-4465-90bf-c0f7a0e4883d" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>CPE: Verifying if outbound traffic from Source Port 5060 is being blocked by checking SIP Registration Status. Expecting Not Registering status...</body>
                    </command>
                    <nestedSteps>
                        <item guid="347771c1-028d-4f17-8b61-d0b7d5418c6f" action="GetRegStatusNeutral" session="CPE" useFieldsInCommand="false">
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>reg_status()</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;NR&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                            <message>CPE: Registration Status is Not Registering. Outbound traffic from CPE is being blocked as should.</message>
                                                        </actionProperties>
                                                    </item>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="RepeatStep">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="6" delayBetweenRepeats="20.0"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <eventHandlers>
                                <item name="OnQueryExtractorInvalidQuery">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                            <message>{auto_message_wait}</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="RepeatStep">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup"/>
                                    </item>
                                </item>
                                <item name="OnNoMatchesFound">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                            <message>{auto_message_wait}</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="RepeatStep">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup"/>
                                    </item>
                                </item>
                            </eventHandlers>
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="b5663234-7ebe-4113-9e2c-4e0611db7aa7" action="comment" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="23c527c6-f28e-4429-b6e5-9695953d2659" action="comment">
                    <command>
                        <body>EDGE: Removing firewall rule...</body>
                    </command>
                    <nestedSteps>
                        <item guid="e5dc0dd8-9c3e-488f-97d7-de7303593383" action="command" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>remove_firewall_rule_block_tcp_source_port()</body>
                            </command>
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>item_item_by_key(&quot;error&quot;)</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;None&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                                            <message>EDGE: Firewall rule removed successfully.</message>
                                                        </actionProperties>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="FailTest">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                                            <message>EDGE: Error removing firewall rule. [value]. Exiting execution.</message>
                                                        </actionProperties>
                                                    </item>
                                                    <item actionId="ExitExecution">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="4e7f8407-94a3-4c13-bd2a-ea483dd381b0" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>Waiting for 10 seconds for change to take effect...</body>
                    </command>
                    <nestedSteps>
                        <item guid="51e45405-48c4-4273-a74d-dd500898a065" action="sleep">
                            <command>
                                <body>10</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="df30596d-30c6-4a5b-b059-361026d4ba60" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>CPE: Verifying if outbound traffic from Source Port 5060 is being allowed by checking SIP Registration Status. Expecting OK status...</body>
                    </command>
                    <nestedSteps>
                        <item guid="b2248671-a568-427f-95fb-852d57de1474" action="GetRegStatusNeutral" session="CPE" useFieldsInCommand="false">
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>reg_status()</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;OK&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                            <message>CPE: Registration Status is OK. Outbound traffic from CPE is being allowed as should.</message>
                                                        </actionProperties>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="RepeatStep">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="6" delayBetweenRepeats="20.0"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <eventHandlers>
                                <item name="OnQueryExtractorInvalidQuery">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                            <message>{auto_message_wait}</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="RepeatStep">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup"/>
                                    </item>
                                </item>
                                <item name="OnNoMatchesFound">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                            <message>{auto_message_wait}</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="RepeatStep">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup"/>
                                    </item>
                                </item>
                            </eventHandlers>
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="66eabb00-f6b3-4185-aaec-38a4dcfdf410" action="comment" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="5c49a05d-4c98-4c53-86f8-e3347af94423" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>CPE: Changing SIP Registration protocol back to UDP...</body>
                    </command>
                    <nestedSteps>
                        <item guid="2108711e-9d95-4540-a76d-ec07ee97627b" action="ChangeRegProtocolToUDP" session="CPE" useFieldsInCommand="false">
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                        <item guid="96dca0a2-404c-4810-80c9-2db3e13e7eab" action="GetRegStatusNeutral" session="CPE" useFieldsInCommand="false">
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>reg_status()</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;OK&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                            <message>CPE: Registration Status is OK after changing SIP Registration protocol to UDP.</message>
                                                        </actionProperties>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="RepeatStep">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="6" delayBetweenRepeats="20.0"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <eventHandlers>
                                <item name="OnRepeatStepMaxCountExceeded">
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                            <message>Maximum number of attempts of {0} has reached the limit</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="DeclareExecutionIssue">
                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                            <message>Changing SIP Registration protocol to UDP did not came back as registering.</message>
                                        </actionProperties>
                                    </item>
                                    <item actionId="FailTest">
                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                    </item>
                                    <item actionId="ExitExecution">
                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                    </item>
                                </item>
                            </eventHandlers>
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="40a33b22-5cbb-426e-92ff-10c8c33d6718" action="close" session="SD-WAN" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="989547f4-ee25-479e-b1cb-f957a04490a5" action="close" session="CPE">
                    <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                </item>
            </steps>
            <multilineDescription>First written for Silverpeak ZB Firewall testing
-----------------------------------------------
Silverpeak
Test Case: Block based on TCP Source Port

Expected Results: MSP traffic is blocked

Usage: Configure outbound rule to deny all traffic based on TCP source port (Configuration &gt; Templates &gt; Default &gt; Template &gt; Security Policies &gt; Click on Zone(One to Default) in Matrix &gt; Add Rule &gt; Priority 1500 &gt; Match Cirteria &quot;Port&quot; &quot;Source:Destination&quot; &gt; &quot;Source 443&quot;; Verify MSP traffic is block.

Assumptions: Make sure Silverpeak&apos;s python based edge (C:\\Users\\dataeng\\PycharmProjects\\iTest_Automation\\d_silverpeak\\my_silverpeak\\base_edge.py) params are up to date.</multilineDescription>
        </item>
        <item name="clean_up">
            <steps>
                <item guid="563bb4b5-6853-41a6-88b4-6ccab6c6d147" action="comment" skip="true" useFieldsInCommand="false">
                    <command>
                        <body>This clean up procedure will make sure the firewall rule to block traffic to destination_ip does not stay on the SD-WAN if test case happens to fail midway.</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="25012f6a-ce0a-4838-8564-c0917977ab96" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>EDGE Cleanup: Removing firewall rule to block outbound traffic based on TCP Source Port 443...</body>
                    </command>
                    <nestedSteps>
                        <item guid="92a118e8-02a1-4321-b1ee-484a734148fd" action="command" session="SD-WAN" useFieldsInCommand="false">
                            <command>
                                <body>remove_firewall_rule_block_tcp_source_port()</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="f554fcbd-e6a9-43b6-a6aa-1bda4d4b8b04" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>CPE: Changing SIP Registration protocol to UDP</body>
                    </command>
                    <nestedSteps>
                        <item guid="7a5237a8-105f-4af7-b4b5-e101c4c2836d" action="ChangeRegProtocolToUDP" session="CPE" useFieldsInCommand="false">
                            <applicationProperties type="com.fnfr.svt.editors.terminal.documents.StepDefaultProperties"/>
                        </item>
                        <item guid="fd560d55-77dd-4e81-b9ba-ffb7b4dcd0f1" action="sleep">
                            <command>
                                <body>20</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="1e800137-5339-4fcb-b3c3-e226e64d8105" action="comment" useFieldsInCommand="false">
                    <command>
                        <body>EDGE Cleanup... Done</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="9e67590e-2337-4267-9c1b-acf37cd2aad6" action="exit" useFieldsInCommand="false">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
            </steps>
        </item>
    </procedures>
    <eventHandlers>
        <item name="OnFailTestAction">
            <item actionId="CallProcedure">
                <actionProperties type="com.fnfr.svt.execution.builtin.actions.CallProcedurePropertyGroup">
                    <command>clean_up</command>
                </actionProperties>
            </item>
        </item>
    </eventHandlers>
</testCase>
